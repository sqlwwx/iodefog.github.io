<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="iodefog"><title>OSX系统添加定时任务 · iodefog</title><meta name="description" content="[转载]：http://honglu.me/2014/09/20/OSX%E7%B3%BB%E7%BB%9F%E6%B7%BB%E5%8A%A0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/
OS X是苹果Mac的操作系统。今天遇到了一个想向系统里添加定时任务的问题。比如"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/./images/logo.png" style="width:127px;"><h3 title=""><a href="/">iodefog</a></h3><div class="description"><p>记录人生道路景色的，点点滴滴。</p></div></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于</a></li><li><a href="/links">链接</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>OSX系统添加定时任务</a></h3></div><div class="post-content"><p>[转载]：<a href="http://honglu.me/2014/09/20/OSX%E7%B3%BB%E7%BB%9F%E6%B7%BB%E5%8A%A0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">http://honglu.me/2014/09/20/OSX%E7%B3%BB%E7%BB%9F%E6%B7%BB%E5%8A%A0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</a></p>
<p>OS X是苹果Mac的操作系统。今天遇到了一个想向系统里添加定时任务的问题。比如我想在12点运行一个脚本，而这个时间我又要出去吃饭。这个时候就可以通过增加定时任务的办法来解决。<br><a id="more"></a></p>
<p>这里主要提供两种方式：</p>
<h2 id="crontab命令"><a href="#crontab命令" class="headerlink" title="crontab命令"></a>crontab命令</h2><p>crontab是Linux下的定时任务命令，OS X显然也是支持这个命令的。下面说一下如何使用:<br>crontab [-u username] [-l|-e|-r]</p>
<p>相关参数：<br>-u ：只有 root 才能进行这个任务，也就是帮其他使用者建立/移除 crontab 工作排程；<br>-e ：编辑 crontab 的工作內容<br>-l ：查看 crontab 的工作內容<br>-r ：移除所有的 crontab 的工作內容，若仅仅移除一项，请用 -e 去编辑。<br>crontab file [-u user]：用指定的文件替代目前的crontab。<br>例一：用 dmtsai 的身份在每天的 12:00 发信给自己<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo crontab -e</span><br><span class="line"># 此时会进入 vi 编辑器！注意到，每项工作都是一行。</span><br><span class="line"># 基本格式：* * * * * command </span><br><span class="line">0 12 * * * mail dmtsai -s&quot;at 12:00&quot; &lt; /home/dmtsai/.bashrc</span><br><span class="line">#分 时 日 月 周 |&lt;==============指令串========================&gt;|</span><br><span class="line">$ sudo crontab -l</span><br><span class="line"># 查看已经添加的定时任务</span><br></pre></td></tr></table></figure></p>
<p>前面五个参数(星号)代表的意义：<br>代表意义分钟小时日期月份周数字范围0-590-231-311-120-7例二：12：00执行这个Python脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo crontab -e</span><br><span class="line">0 12 * * * /usr/bin/python /Users/aigo/Documents/demo.py</span><br></pre></td></tr></table></figure></p>
<p>使用问题：</p>
<ol>
<li>如果使用crontab -e编辑无法保存，说明你还没有相关文件，你可以新建一个txt文件，文件内协商你要执行的任务。然后通过<code>sudo
crontab file</code>这个命令来新建相关文件，然后你就可以通过<code>crontab
-e</code>来修改定时任务了</li>
<li>通过上面的命令介绍可见crontab的最小时间间隔是一分钟</li>
</ol>
<p>参考</p>
<p>[鸟哥的Linux私房菜</p>
<ul>
<li>例行性工作排程 (crontab)](<a href="http://linux.vbird.org/linux_basic/0430cron.php#cron" target="_blank" rel="noopener">http://linux.vbird.org/linux_basic/0430cron.php#cron</a>)<br><a href="http://www.jb51.net/LINUXjishu/19905.html" target="_blank" rel="noopener">Linux<br>crontab定时执行任务 命令格式与详细例子</a><br><a href="http://blog.sina.com.cn/s/blog_60b45f2301011hqp.html" target="_blank" rel="noopener">Mac<br>os下定时启动一个脚本</a><h2 id="launchctl-定时任务-推荐"><a href="#launchctl-定时任务-推荐" class="headerlink" title="launchctl 定时任务(推荐)"></a>launchctl 定时任务(推荐)</h2>这个是通过plist配置的方式来实现定时任务的，其优点就是最小时间间隔是一秒<br>plist脚本存放路径为/Library/LaunchDaemons或/Library/LaunchAgents，其区别是后一个路径的脚本当用户登陆系统后才会被执行，前一个只要系统启动了，哪怕用户不登陆系统也会被执行。<br>可以通过两种方式来设置脚本的执行时间。一个是使用StartInterval，它指定脚本每间隔多长时间（单位：秒）执行一次；另外一个使用StartCalendarInterval，它可以指定脚本在多少分钟、小时、天、星期几、月时间上执行，类似如crontab的中的设置。<br>例:<br>新建一个shell文件<code>/Users/aigo/Documents/AutoMakeLog.sh</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">/usr/bin/python /Users/aigo/Documents/AutoMakeLog.py</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>脚本要改成可执行的权限<br>    chmod 777 AutoMakeLog.sh</p>
<p>进入到<code>~/Library/LaunchAgents</code>下建一个plist文件<code>com.aigo.launchctl.plist</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plistversion=&quot;1.0&quot;&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">&lt;key&gt;Label&lt;/key&gt;</span><br><span class="line">&lt;string&gt;com.aigo.launchctl.plist&lt;/string&gt;</span><br><span class="line">&lt;key&gt;ProgramArguments&lt;/key&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">&lt;string&gt;/Users/aigo/Documents/AutoMakeLog.sh&lt;/string&gt;</span><br><span class="line">&lt;/array&gt;</span><br><span class="line">&lt;key&gt;StartCalendarInterval&lt;/key&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">&lt;key&gt;Minute&lt;/key&gt;</span><br><span class="line">&lt;integer&gt;4&lt;/integer&gt;</span><br><span class="line">&lt;key&gt;Hour&lt;/key&gt;</span><br><span class="line">&lt;integer&gt;13&lt;/integer&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;key&gt;StandardOutPath&lt;/key&gt;</span><br><span class="line">&lt;string&gt;/Users/aigo/Documents/AutoMakeLog.log&lt;/string&gt;</span><br><span class="line">&lt;key&gt;StandardErrorPath&lt;/key&gt;</span><br><span class="line">&lt;string&gt;/Users/aigo/Documents/AutoMakeLog.err&lt;/string&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br></pre></td></tr></table></figure></p>
<p>label这里就是给这个任务名个名字，这里一般取plist的文件名，这个名字不能和其它的plist重复。AutoMakeLog.sh就是我们要执行的脚本，StartCalendarInterval里边的参数是说每一天13点4分的时候执行一下脚本。<br>然后就可以用下面的几个命令进行操作我们做好的任务了。<br>    launchctl load   com.aigo.launchctl.plist<br>    launchctl unload com.aigo.launchctl.plist<br>    launchctl start  com.aigo.launchctl.plist<br>    launchctl stop   com.aigo.launchctl.plist<br>    launchctl list</p>
<ul>
<li>要让任务生效，必须先load命令加载这个plist</li>
<li>如果任务呗修改了，那么必须先unload，然后重新load</li>
<li>start可以测试任务，这个是立即执行，不管时间到了没有</li>
<li>执行start和unload前，任务必须先load过，否则报错</li>
<li>stop可以停止任务</li>
<li>ProgramArguments内不能直接写命令，只能通过shell脚本来执行</li>
</ul>
<p>上面的任务我们也可以指定为每隔30秒执行一次，如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plistversion=&quot;1.0&quot;&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">&lt;key&gt;Label&lt;/key&gt;</span><br><span class="line">&lt;string&gt;com.aigo.launchctl.plist&lt;/string&gt;</span><br><span class="line">&lt;key&gt;ProgramArguments&lt;/key&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">&lt;string&gt;/Users/aigo/Documents/AutoMakeLog.sh&lt;/string&gt;</span><br><span class="line">&lt;/array&gt;</span><br><span class="line">&lt;key&gt;KeepAlive&lt;/key&gt;</span><br><span class="line">&lt;false/&gt;</span><br><span class="line">&lt;key&gt;RunAtLoad&lt;/key&gt;</span><br><span class="line">&lt;true/&gt;</span><br><span class="line">&lt;key&gt;StartInterval&lt;/key&gt;</span><br><span class="line">&lt;integer&gt;30&lt;/integer&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br></pre></td></tr></table></figure></p>
<p>参考<br><a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man5/launchd.plist.5.html" target="_blank" rel="noopener">launchd.plist官方说明</a><br><a href="http://my.oschina.net/jackin/blog/263024" target="_blank" rel="noopener">Mac<br> 使用 launchctl 定时运行程序</a><br><a href="http://blog.ixtr.me/2012/05/osx%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">管理OSX后台服务</a><br><a href="http://www.netingcn.com/mac-os-plist.html" target="_blank" rel="noopener">mac<br> os 定期任务配置</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-11-28</span><i class="fa fa-tag"></i><a href="/categories/技术/" title="技术" class="tag">技术 </a></div></div></div></div><div class="pagination"><ul class="clearfix"></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>